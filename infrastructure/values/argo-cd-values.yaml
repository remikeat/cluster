global:
  domain: "argocd.remikeat.com"
  affinity:
    podAntiAffinity: hard
configs:
  params:
    server:
      insecure: true
server:
  replicas: 2
  ingress:
    enabled: true
    ingressClassName: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-production"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    extraTls:
      - hosts:
          - "argocd.remikeat.com"
        secretName: "argocd-tls"
repoServer:
  replicas: 2
  volumes:
    - name: bw-secrets
      secret:
        secretName: bw-secrets
        optional: true
    - name: custom-cmp-config
      configMap:
        name: custom-cmp-config
    - name: cmp-tmp
      emptyDir: {}
    - name: repo
      emptyDir: {}
    - name: git-askpass
      configMap:
        name: git-askpass
        defaultMode: 0555
        items:
          - key: git_askpass.sh
            path: git_askpass.sh
    - name: template
      configMap:
        name: template
        defaultMode: 0555
        items:
          - key: template.py
            path: template.py
    - name: values
      configMap:
        name: values
        defaultMode: 0555
        items:
          - key: values.py
            path: values.py
  extraContainers:
    - name: custom-cmp
      command:
        - "/var/run/argocd/argocd-cmp-server"
      image: ghcr.io/remikeat/cluster:latest
      env:
        - name: GIT_ASKPASS
          value: /usr/local/bin/git_askpass.sh
        - name: GIT_USERNAME
          valueFrom:
            secretKeyRef:
              name: github-https
              key: username
        - name: GIT_TOKEN
          valueFrom:
            secretKeyRef:
              name: github-https
              key: password
      securityContext:
        runAsNonRoot: true
        runAsUser: 999
      volumeMounts:
        - name: git-askpass
          mountPath: /usr/local/bin/git_askpass.sh
          subPath: git_askpass.sh
        - name: values
          mountPath: /usr/local/bin/values.py
          subPath: values.py
        - name: template
          mountPath: /usr/local/bin/template.py
          subPath: template.py
        - mountPath: /var/run/argocd
          name: var-files
        - mountPath: /home/argocd/cmp-server/plugins
          name: plugins
        - mountPath: /home/argocd/cmp-server/config/plugin.yaml
          name: custom-cmp-config
          subPath: plugin.yaml
        - mountPath: /tmp
          name: cmp-tmp
        - mountPath: /bw-secrets
          name: bw-secrets
        - mountPath: /repo
          name: repo
  imagePullSecrets:
    - name: github-registry
